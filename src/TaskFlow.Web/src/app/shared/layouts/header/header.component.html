<mat-toolbar class="header">
    <div class="header-left">
        <div class="brand">
            <div class="brand-text" style="display: flex; flex-direction: column; align-items: center;">
                <span class="brand-name" style="font-size: x-large;"><img src="assets/brand/taskflow-brand.svg"
                        class="sidebar-logo" alt="TaskFlow Logo"></span>
            </div>
        </div>
    </div>

    <div class="header-center">
        <mat-form-field appearance="outline" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input matInput placeholder="Search tasks, projects, or team members..." [matAutocomplete]="auto">
            <button mat-icon-button matSuffix matTooltip="Advanced Search" (click)="openAdvancedSearch()">
                <mat-icon>tune</mat-icon>
            </button>
            <mat-autocomplete #auto="matAutocomplete">
                <mat-option *ngFor="let result of searchResults" [value]="result.title">
                    <mat-icon>{{result.icon}}</mat-icon>
                    <span>{{result.title}}</span>
                    <small>{{result.category}}</small>
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>
    </div>

    <div class="header-right">
        <div class="quick-stats">
            <div class="stat-item" matTooltip="Tasks Due Today">
                <mat-icon [class.warning]="dueTodayCount > 5">assignment_late</mat-icon>
                <span>{{dueTodayCount}}</span>
            </div>
            <div class="stat-item" matTooltip="Active Projects">
                <mat-icon>folder_special</mat-icon>
                <span>{{activeProjectsCount}}</span>
            </div>
        </div>

        <button mat-icon-button [matMenuTriggerFor]="notificationsMenu" class="notification-btn"
            matTooltip="Notifications">
            <mat-icon [matBadge]="notificationCount" [matBadgeHidden]="notificationCount === 0" matBadgeColor="warn"
                aria-hidden="false" [attr.aria-label]="'You have ' + notificationCount + ' notifications'">
                notifications
            </mat-icon>
        </button>

        <button mat-icon-button class="theme-toggle" (click)="toggleTheme()"
            [matTooltip]="(isDarkTheme$ | async) ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
            <mat-icon>{{ (isDarkTheme$ | async) ? 'light_mode' : 'dark_mode' }}</mat-icon>
        </button>

        <button mat-button [matMenuTriggerFor]="profileMenu" class="profile-btn">
            <div class="user-info">
                <img [src]="userAvatar" alt="Profile" class="avatar" [class.online]="userStatus === 'online'">
                <span class="user-name">lhajoosten&#64;outlook.com</span>
            </div>
            <mat-icon>arrow_drop_down</mat-icon>
        </button>
    </div>
</mat-toolbar>

<mat-menu #notificationsMenu="matMenu" class="notifications-menu">
    <div class="notifications-header">
        <h3>Notifications</h3>
        <div class="notification-actions">
            <button mat-icon-button matTooltip="Filter Notifications" [matMenuTriggerFor]="filterMenu">
                <mat-icon>filter_list</mat-icon>
            </button>
            <button mat-button color="primary" (click)="markAllAsRead()">
                Mark all as read
            </button>
        </div>
    </div>
    <mat-divider></mat-divider>
    <div class="notifications-list" *ngIf="notifications.length; else noNotifications">
        <button mat-menu-item *ngFor="let notification of notifications" [class.unread]="!notification.read"
            (click)="handleNotification(notification)">
            <mat-icon [class.unread]="!notification.read">{{ notification.icon }}</mat-icon>
            <div class="notification-content">
                <span class="notification-message">{{ notification.message }}</span>
                <span class="notification-time">{{ notification.time | timeAgo }}</span>
            </div>
            <button mat-icon-button class="notification-action"
                (click)="$event.stopPropagation(); markAsRead(notification)">
                <mat-icon>check</mat-icon>
            </button>
        </button>
    </div>
    <ng-template #noNotifications>
        <div class="no-notifications">
            <mat-icon>notifications_none</mat-icon>
            <span>No new notifications</span>
        </div>
    </ng-template>
</mat-menu>

<mat-menu #filterMenu="matMenu">
    <button mat-menu-item *ngFor="let filter of notificationFilters" (click)="filterNotifications(filter.type)">
        <mat-icon>{{filter.icon}}</mat-icon>
        <span>{{filter.label}}</span>
    </button>
</mat-menu>

<mat-menu #profileMenu="matMenu" class="profile-menu">
    <div class="profile-header">
        <img [src]="userAvatar" alt="Profile" class="profile-avatar">
        <div class="profile-info">
            <strong>lhajoosten&#64;outlook.com</strong>
            <small>Administrator</small>
        </div>
    </div>
    <mat-divider></mat-divider>
    <div style="text-align: center">
        <button mat-menu-item routerLink="/profile">
            <mat-icon>account_circle</mat-icon>
            <span>My Profile</span>
        </button>
        <button mat-menu-item routerLink="/settings">
            <mat-icon>settings</mat-icon>
            <span>Settings</span>
        </button>
        <button mat-menu-item routerLink="/help">
            <mat-icon>help</mat-icon>
            <span>Help Center</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Sign Out</span>
        </button>
    </div>
</mat-menu>